<!--timetsble.html-->

<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>ì‹œê°„í‘œ & í”Œë˜ë„ˆ</title>
<link rel="stylesheet" href="{{ url_for('static', filename='timetable.css') }}">
</head>
<body>
<div class="wrapper">
  <h1>ğŸ“… ì‹œê°„í‘œ</h1>

  <!-- ìˆ˜ì—… ì¶”ê°€ -->
  <form class="course-form" action="{{ url_for('add_course') }}" method="post">
    <input name="subject" placeholder="ê³¼ëª©ëª…" required>
    <input name="prof"    placeholder="êµìˆ˜ëª…">
    <input name="room"    placeholder="ê°•ì˜ì‹¤">
    <select name="day">{% for d in days %}<option value="{{d}}">{{d}}</option>{% endfor %}</select>
    <input name="start" placeholder="ì‹œì‘ (09:30)" required>
    <input name="end"   placeholder="ì¢…ë£Œ (11:00)" required>
    <button type="submit">ìˆ˜ì—… ì¶”ê°€</button>
  </form>

  <!-- ì‹œê°„í‘œ -->
  <div class="timetable-wrap">
    <!-- ìš”ì¼ í—¤ë” -->
    <div class="day-row">
      <div class="corner"></div>
      {% for d in days %}<div class="day">{{ d }}</div>{% endfor %}
    </div>

    <!-- ë³¸ì²´ -->
    <div class="body-row">
      <!-- ì‹œê°„ì¶• -->
      <div class="time-col">
        {% for h in hours %}<div class="time">{{ '%02d:00'|format(h) }}</div>{% endfor %}
      </div>

      <!-- ê·¸ë¦¬ë“œ & ë¸”ë¡ -->
      <div class="grid-col">
        <div class="grid-bg"></div>
        {% for b in blocks %}
        <div class="block" data-id="{{ b.id }}"
             style="left:{{ b.left }}%; top:{{ b.top }}%;
                    width:{{ b.width }}%; height:{{ b.height }}%;"
             onclick="openEdit(this)">
          <strong>{{ b.subject }}</strong><br>{{ b.prof }}<br>{{ b.room }}
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€ í”Œë˜ë„ˆ â”€â”€â”€â”€â”€ -->
<section class="planner">
    <h2>ğŸ“– ì£¼ê°„ í•™ìŠµ í”Œë˜ë„ˆ</h2>
  
    <form class="plan-input" action="{{ url_for('add_plan') }}" method="post">
      <input name="plan" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
      <button type="submit">ì¶”ê°€</button>
      <button type="button" id="gpt-btn">GPT ì¶”ì²œë°›ê¸°</button>
    </form>
  
    <ul class="plan-list">
      {% for p in plans %}
      <li data-id="{{ p.id }}" class="{% if p.done %}done{% endif %}">
        <label>
          <input type="checkbox" {% if p.done %}checked{% endif %}
                 onclick="togglePlan(event,this)">
          <span>{{ p.text }}</span>
        </label>
      </li>
      {% endfor %}
    </ul>
  </section>
  
  <!-- ê¸°ì¡´ GPT / íŒì—… ìŠ¤í¬ë¦½íŠ¸ ìœ ì§€ -->
  <script>
  /* í”Œë˜ë„ˆ ì²´í¬ í† ê¸€ */
  function togglePlan(ev,cb){
    ev.stopPropagation();
    const li=cb.closest("li"), id=li.dataset.id;
    fetch(`/plan/${id}/toggle`,{method:"POST"}).then(()=> li.classList.toggle("done"));
  }
  
  /* GPT ë²„íŠ¼ (ë³€ê²½ ì—†ìŒ) */
  document.getElementById("gpt-btn").onclick=async()=>{
    const b=event.target;b.disabled=true;b.textContent="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
    try{const r=await fetch("{{ url_for('gpt') }}",{method:"POST"});
        if(r.ok)location.reload();else alert("GPT ì˜¤ë¥˜");}
    finally{b.disabled=false;b.textContent="GPT ì¶”ì²œë°›ê¸°";}
  };
  
  /* íŒì—… ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ ê·¸ëŒ€ë¡œ â€¦ */
  </script>
  </body>
  </html>